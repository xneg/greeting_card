<template>
    <svg
        id="ball" 
        v-touch:tap= "click" 
        ref="ball" 
        :style='{
            left: initialLeftPosition,
            bottom: initialBottomPosition
        }' 
        v-if="alive"
        xmlns:dc="http://purl.org/dc/elements/1.1/"
        xmlns:cc="http://creativecommons.org/ns#"
        xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
        xmlns:svg="http://www.w3.org/2000/svg"
        xmlns="http://www.w3.org/2000/svg"
        version="1.1"
        viewBox="0 0 50 50"
        height="100px"
        width="100px">
        <defs
            id="defs901" />
        <metadata
            id="metadata904">
            <rdf:RDF>
            <cc:Work
                rdf:about="">
                <dc:format>image/svg+xml</dc:format>
                <dc:type
                rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
                <dc:title></dc:title>
            </cc:Work>
            </rdf:RDF>
        </metadata>
        <g
            transform="translate(-6.3463477,-92.526686)"
            id="layer1">
            <g
            transform="matrix(0.92929086,0,0,0.92929982,-135.90283,-37.940005)"
            id="g880">
            <path
                style="opacity:1;fill:#000000;fill-opacity:1;stroke:none;stroke-width:9.46619129;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                d="m 641.56641,636.125 a 101.67648,118.47973 0 0 0 25.92578,52.14258 101.67648,179.71188 80.47199 0 0 31.26758,-3.54688 101.67648,179.71188 80.47199 0 0 79.24804,-24.93164 101.67648,101.67648 0 0 0 3.88867,-27.49609 101.67648,101.67648 0 0 0 -1.50781,-16.55664 83.054633,162.96493 79.564741 0 1 -8.65625,3.40429 83.054633,162.96493 79.564741 0 1 -15.0664,4.98829 83.054633,162.96493 79.564741 0 1 -15.55469,4.2539 83.054633,162.96493 79.564741 0 1 -11.22266,2.54297 83.054633,162.96493 79.564741 0 1 -16.02734,2.90625 83.054633,162.96493 79.564741 0 1 -16.08985,2.07422 83.054633,162.96493 79.564741 0 1 -15.99023,1.22266 83.054633,162.96493 79.564741 0 1 -15.73047,0.35742 83.054633,162.96493 79.564741 0 1 -15.31445,-0.50781 83.054633,162.96493 79.564741 0 1 -9.16992,-0.85352 z"
                id="path1020"
                transform="scale(0.26458333)" />
            <path
                style="opacity:1;fill:#333333;fill-opacity:1;stroke:none;stroke-width:9.46619129;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                d="m 641.56641,636.125 a 83.054633,162.96493 79.564741 0 0 9.16992,0.85352 83.054633,162.96493 79.564741 0 0 15.31445,0.50781 83.054633,162.96493 79.564741 0 0 15.73047,-0.35742 83.054633,162.96493 79.564741 0 0 15.99023,-1.22266 83.054633,162.96493 79.564741 0 0 16.08985,-2.07422 83.054633,162.96493 79.564741 0 0 16.02734,-2.90625 83.054633,162.96493 79.564741 0 0 11.22266,-2.54297 83.054633,162.96493 79.564741 0 0 15.55469,-4.2539 83.054633,162.96493 79.564741 0 0 15.0664,-4.98829 83.054633,162.96493 79.564741 0 0 8.65625,-3.40429 101.67648,101.67648 0 0 0 -23.34179,-49.85352 101.67648,179.71188 80.47199 0 0 -0.65821,-0.01 v -0.002 a 101.67648,179.71188 80.47199 0 0 -53.12695,4.3125 101.67648,179.71188 80.47199 0 0 -64.4043,18.26953 101.67648,118.47973 0 0 0 -1.07617,16.21485 101.67648,118.47973 0 0 0 3.78516,31.45703 z"
                id="circle928"
                transform="scale(0.26458333)" />
            <path
                style="opacity:1;fill:#333333;fill-opacity:1;stroke:none;stroke-width:7.14556456;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                d="m 617.41797,580.69531 a 84.870607,99.253051 0 0 0 -14.37891,-1.61719 84.870607,99.253051 0 0 0 -9.75195,0.72266 101.67648,101.67648 0 0 0 -14.74414,52.49219 101.67648,101.67648 0 0 0 65.88867,95.04101 84.870607,99.253051 0 0 0 11.57422,-14.11523 97.971439,97.971439 0 0 1 -7.86719,-4.82422 97.971439,97.971439 0 0 1 -7.79492,-5.92578 97.971439,97.971439 0 0 1 -7.16602,-6.67578 97.971439,97.971439 0 0 1 -6.46289,-7.35742 97.971439,97.971439 0 0 1 -5.69726,-7.96485 97.971439,97.971439 0 0 1 -4.87305,-8.49609 97.971439,97.971439 0 0 1 -4,-8.9375 97.971439,97.971439 0 0 1 -3.08789,-9.29297 97.971439,97.971439 0 0 1 -2.14453,-9.55664 97.971439,97.971439 0 0 1 -1.17969,-9.7207 97.971439,97.971439 0 0 1 -0.24609,-6.93164 97.971439,97.971439 0 0 1 0.49023,-9.7793 97.971439,97.971439 0 0 1 1.46289,-9.68359 97.971439,97.971439 0 0 1 2.42188,-9.48829 97.971439,97.971439 0 0 1 3.35937,-9.19921 97.971439,97.971439 0 0 1 4.19727,-8.68946 z"
                id="path966"
                transform="scale(0.26458333)" />
            <path
                style="opacity:1;fill:#aa0000;fill-opacity:1;stroke:none;stroke-width:7.14556456;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                d="m 617.41797,580.69531 a 97.971439,97.971439 0 0 0 -4.19727,8.68946 97.971439,97.971439 0 0 0 -3.35937,9.19921 97.971439,97.971439 0 0 0 -2.42188,9.48829 97.971439,97.971439 0 0 0 -1.46289,9.68359 97.971439,97.971439 0 0 0 -0.49023,9.7793 97.971439,97.971439 0 0 0 0.24609,6.93164 97.971439,97.971439 0 0 0 1.17969,9.7207 97.971439,97.971439 0 0 0 2.14453,9.55664 97.971439,97.971439 0 0 0 3.08789,9.29297 97.971439,97.971439 0 0 0 4,8.9375 97.971439,97.971439 0 0 0 4.87305,8.49609 97.971439,97.971439 0 0 0 5.69726,7.96485 97.971439,97.971439 0 0 0 6.46289,7.35742 97.971439,97.971439 0 0 0 7.16602,6.67578 97.971439,97.971439 0 0 0 7.79492,5.92578 97.971439,97.971439 0 0 0 7.86719,4.82422 84.870607,99.253051 0 0 0 12.2793,-25.02344 101.67648,179.71188 80.47199 0 1 -0.79297,0.0723 101.67648,118.47973 0 0 1 -29.71094,-83.59961 101.67648,118.47973 0 0 1 1.07031,-16.13477 84.870607,99.253051 0 0 0 -21.43359,-7.83789 z"
                id="path940"
                transform="scale(0.26458333)" />
            <path
                style="opacity:1;fill:#ff5555;fill-opacity:1;stroke:none;stroke-width:7.12028074;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                d="m 699.18945,570.96875 a 98.779556,67.7274 57.917149 0 0 -6.93945,-6.54492 98.779556,67.7274 57.917149 0 0 -7.25391,-5.88086 98.779556,67.7274 57.917149 0 0 -7.49609,-5.15625 98.779556,67.7274 57.917149 0 0 -7.66406,-4.38086 98.779556,67.7274 57.917149 0 0 -7.75391,-3.56445 98.779556,67.7274 57.917149 0 0 -7.76758,-2.70703 98.779556,67.7274 57.917149 0 0 -7.70507,-1.82813 98.779556,67.7274 57.917149 0 0 -7.5625,-0.92773 98.779556,67.7274 57.917149 0 0 -1.04102,-0.002 101.67648,101.67648 0 0 0 -44.71875,39.82422 84.870606,99.25305 0 0 1 9.75195,-0.72266 84.870606,99.25305 0 0 1 35.8125,9.45508 101.67648,118.47973 0 0 1 0.008,-0.0801 101.67648,179.71188 80.47199 0 1 60.33007,-17.48437 z"
                id="path1015"
                transform="scale(0.26458333)" />
            <path
                style="opacity:1;fill:#000000;fill-opacity:1;stroke:none;stroke-width:7.12028074;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                d="m 680.21875,530.61719 a 101.67648,101.67648 0 0 0 -42.21289,9.35937 98.779556,67.7274 57.917149 0 1 1.04102,0.002 98.779556,67.7274 57.917149 0 1 7.5625,0.92773 98.779556,67.7274 57.917149 0 1 7.70507,1.82813 98.779556,67.7274 57.917149 0 1 7.76758,2.70703 98.779556,67.7274 57.917149 0 1 7.75391,3.56445 98.779556,67.7274 57.917149 0 1 7.66406,4.38086 98.779556,67.7274 57.917149 0 1 7.49609,5.15625 98.779556,67.7274 57.917149 0 1 7.25391,5.88086 98.779556,67.7274 57.917149 0 1 6.93945,6.54492 101.67648,179.71188 80.47199 0 1 4.07422,-0.78516 101.67648,179.71188 80.47199 0 1 53.12695,-4.3125 101.67648,179.71188 80.47199 0 1 0.65821,0.0117 101.67648,101.67648 0 0 1 6.23828,7.98242 101.67648,101.67648 0 0 0 -83.06641,-43.24804 z"
                id="path1004"
                transform="scale(0.26458333)" />
            <path
                style="opacity:1;fill:#aa0000;fill-opacity:1;stroke:none;stroke-width:7.12028074;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                d="m 781.68164,627.97461 a 101.67648,101.67648 0 0 1 0.2168,4.31836 101.67648,101.67648 0 0 0 -0.20703,-4.32031 c -0.003,8.5e-4 -0.007,10e-4 -0.01,0.002 z"
                id="path1002"
                transform="scale(0.26458333)" />
            <path
                style="opacity:1;fill:#aa0000;fill-opacity:1;stroke:none;stroke-width:7.12028074;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                d="m 781.68164,627.97461 c 0.003,-8.5e-4 0.007,-10e-4 0.01,-0.002 a 101.67648,101.67648 0 0 0 -0.041,-0.64063 101.67648,101.67648 0 0 1 0.0312,0.64258 z"
                id="path999"
                transform="scale(0.26458333)" />
            <path
                style="opacity:1;fill:#aa0000;fill-opacity:1;stroke:none;stroke-width:7.12028074;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                d="m 709.30859,729.66016 c 33.27548,-9.93111 59.43259,-36.3648 68.82227,-69.8711 h -0.12305 c -18.77041,9.12432 -39.64831,16.27811 -61.45703,21.28711 a 56.390541,66.92817 25.688537 0 1 0.75781,3.96485 56.390541,66.92817 25.688537 0 1 0.59571,6.32617 56.390541,66.92817 25.688537 0 1 0.0117,6.44531 56.390541,66.92817 25.688537 0 1 -0.57227,6.5 56.390541,66.92817 25.688537 0 1 -1.15039,6.49219 56.390541,66.92817 25.688537 0 1 -1.7168,6.41797 56.390541,66.92817 25.688537 0 1 -2.26758,6.27929 56.390541,66.92817 25.688537 0 1 -1.92382,4.32813 56.390541,66.92817 25.688537 0 1 -0.97657,1.83008 z"
                id="path868"
                transform="scale(0.26458333)" />
            <path
                style="opacity:1;fill:#ff5555;fill-opacity:1;stroke:none;stroke-width:7.12028074;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                d="m 709.30859,729.66016 a 56.390541,66.92817 25.688537 0 0 0.97657,-1.83008 56.390541,66.92817 25.688537 0 0 1.92382,-4.32813 56.390541,66.92817 25.688537 0 0 2.26758,-6.27929 56.390541,66.92817 25.688537 0 0 1.7168,-6.41797 56.390541,66.92817 25.688537 0 0 1.15039,-6.49219 56.390541,66.92817 25.688537 0 0 0.57227,-6.5 56.390541,66.92817 25.688537 0 0 -0.0117,-6.44531 56.390541,66.92817 25.688537 0 0 -0.59571,-6.32617 56.390541,66.92817 25.688537 0 0 -0.75781,-3.96485 c -5.87895,1.35027 -11.79344,2.62546 -17.79101,3.64453 -10.13813,1.65808 -20.33369,2.82053 -30.47461,3.47461 -5.08925,15.13455 -13.28059,28.57486 -23.85352,39.13867 11.43277,4.34673 23.55599,6.595 35.78711,6.63672 10.12161,1.3e-4 19.86369,-1.55699 29.08984,-4.31054 z"
                id="path859"
                transform="scale(0.26458333)" />
            </g>
        </g>
    </svg>
</template>

<script>
import {TweenMax, Power2, TimelineLite} from "gsap/TweenMax";
import { mapMutations } from 'vuex'

export default {
    props: ['parentWidth', 'parentHeight'],
    data: function() {
        return {
            alive: true,
            clicked: false,
            ball: null,
            leftSide: false,
        }
    },
    computed: {
        initialBottomPosition() {
            return this.getRandomInRange(this.parentHeight / 2, this.parentHeight - 50) + 'px';
        },
        initialLeftPosition() {
            this.leftSide = Math.random() >= 0.5;
            // todo: потом улучшить
            if (this.leftSide)
                //todo: пока константа
                return '-50px';
            else
                return this.parentWidth + 'px';
        },
        finalPosition() {
            // потом тоже улучшить
            var randomLength = this.getRandomInRange(this.parentWidth / 2, this.parentWidth - 50);
            if (this.leftSide)
                return "+=" + randomLength;
            else
                return "-=" + randomLength;
        }
    },
    methods: {
        ...mapMutations({addClickedBall: 'ballsClickedIncrement'}),
        ...mapMutations({addBall: 'ballsTotalIncrement'}),
        ...mapMutations({deleteBall: 'ballsTotalDecrement'}),
        destroy() {
            TweenMax.to(this.ball, 0.2, {opacity: 0, onComplete: del}); 
            var vm = this;
            function del() {
                vm.deleteBall();
                vm.alive = false;
            }
        },
        click() {
            if (!this.clicked)
            {    
                this.clicked = true;
                this.addClickedBall();
                this.$emit('clicked');
                this.destroy();
            }
        },
        getRandomInRange(min, max) {
            return Math.random() * (max - min) + min;  
        },
        play(destroy, finalPosition) {
            var rotation = this.leftSide ? 360: -360;
            TweenMax.to(this.ball, 4, {rotation: rotation}); 
            var tl = new TimelineLite();
            tl.to(this.ball, 3, {bottom: 0, ease:Bounce.easeOut})
              .to(this.ball, 3, {x: finalPosition, onComplete: destroy}, "-=3");
        }
    },
    mounted() {
        this.ball = this.$refs.ball;
        this.addBall();
        var vm = this;
        this.play(this.destroy, this.finalPosition);
    } 
}
</script>

<style>
    #ball {
        height: 50px;
        width: 50px;
        display: inline-block;
        position: absolute;
    }
</style>
